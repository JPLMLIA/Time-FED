<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Configurations - TimeFED</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/mkapi-common.css" rel="stylesheet" />
        <link href="../css/mkapi-material.css" rel="stylesheet" />
        <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Configurations";
        var mkdocs_page_input_path = "configs.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> TimeFED
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../usage/">Getting Started</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="#">Configurations</a>
    <ul class="current">
    </ul>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">API</span></p>
              <ul>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">TimeFED</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">Configurations</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="configuration">Configuration</h1>
<p>The TimeFED system uses <a href="https://jammont.github.io/mlky/">mlky</a> for its configuration module to validate users' configs and enable quick generation of experiment config setups. To begin, generate a new config via the CLI:</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>timefed<span class="w"> </span>config<span class="w"> </span>generate
Wrote<span class="w"> </span>template<span class="w"> </span>configuration<span class="w"> </span>to:<span class="w"> </span>generated.yml
</code></pre></div>
<p>This will create a configuration file using the TimeFED default parameters. There are many options to tweak the system, be sure to read the comment for an option before modifying it.</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>cat<span class="w"> </span>generated.yml
generated:<span class="w">                    </span><span class="c1">#   | dict  | Generated via mlky toYaml</span>
<span class="w">  </span>cores:<span class="w"> </span><span class="m">10</span><span class="w">                   </span><span class="c1">#   | int   | Number of cores to use for multiprocessing</span>
<span class="w">  </span>log:<span class="w">                        </span><span class="c1">#   | dict  | Controls the logger</span>
<span class="w">    </span>file:<span class="w"> </span>timefed.log<span class="w">         </span><span class="c1">#   | str   | File to write log outputs to. Omit to not write to file</span>
<span class="w">    </span>mode:<span class="w"> </span>write<span class="w">               </span><span class="c1">#   | str   | File write mode, ie: `write` = overwite the file, `append` = append to existing</span>
<span class="w">    </span>level:<span class="w"> </span>DEBUG<span class="w">              </span><span class="c1">#   | str   | Logger level. This is the level that will write to file if enabled</span>
<span class="w">    </span>terminal:<span class="w"> </span>DEBUG<span class="w">           </span><span class="c1">#   | str   | The terminal level to log, ie. logger level to write to terminal. This can be different than the file level</span>
<span class="w">    </span>mlflow:<span class="w"> </span>False<span class="w">             </span><span class="c1">#   | bool  | Enables MLFlow logging</span>
...<span class="w"> </span><span class="c1"># truncated for README</span>
<span class="w">  </span>extract:<span class="w">                    </span><span class="c1">#   | dict  | Options for the `extract` module</span>
<span class="w">    </span>enabled:<span class="w"> </span>True<span class="w">             </span><span class="c1"># * | bool  | Enables/disables this module in a pipeline execution</span>
<span class="w">    </span>cores:<span class="w"> </span><span class="m">10</span><span class="w">                 </span><span class="c1">#   | int   | Number of cores to use for the extract module</span>
<span class="w">    </span>method:<span class="w"> </span>tsfresh<span class="w">           </span><span class="c1"># * | str   | Window processing method</span>
<span class="w">    </span>file:<span class="w"> </span>preprocess.h5<span class="w">       </span><span class="c1"># * | str   | Path to an H5 file to read from / write to</span>
<span class="w">    </span>output:<span class="w"> </span>preprocess.h5.pqt<span class="w"> </span><span class="c1"># * | str   | Path to write the intermediary data products of the extract script</span>
</code></pre></div>
<p>The default <code>generate</code> command will produce an <strong>interpolated</strong> configuration. There are magic strings under mlky that will replace/update the value for a configuration key. For example, a non-interpolated config can be generated via:</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>timefed<span class="w"> </span>config<span class="w"> </span>generate<span class="w"> </span>-ni<span class="w"> </span>-f<span class="w"> </span>raw-generated.yml
Wrote<span class="w"> </span>template<span class="w"> </span>configuration<span class="w"> </span>to:<span class="w"> </span>raw-generated.yml
$<span class="w"> </span>cat<span class="w"> </span>raw-generated.yml
generated:<span class="w">                         </span><span class="c1">#   | dict  | Generated via mlky toYaml</span>
<span class="w">  </span>cores:<span class="w"> </span><span class="si">${</span><span class="p">!os.cpu_count</span><span class="si">}</span><span class="w">          </span><span class="c1">#   | int   | Number of cores to use for multiprocessing</span>
<span class="w">  </span>log:<span class="w">                             </span><span class="c1">#   | dict  | Controls the logger</span>
<span class="w">    </span>file:<span class="w"> </span>timefed.log<span class="w">              </span><span class="c1">#   | str   | File to write log outputs to. Omit to not write to file</span>
<span class="w">    </span>mode:<span class="w"> </span>write<span class="w">                    </span><span class="c1">#   | str   | File write mode, ie: `write` = overwite the file, `append` = append to existing</span>
<span class="w">    </span>level:<span class="w"> </span>DEBUG<span class="w">                   </span><span class="c1">#   | str   | Logger level. This is the level that will write to file if enabled</span>
<span class="w">    </span>terminal:<span class="w"> </span><span class="si">${</span><span class="p">.level</span><span class="si">}</span><span class="w">            </span><span class="c1">#   | str   | The terminal level to log, ie. logger level to write to terminal. This can be different than the file level</span>
<span class="w">    </span>mlflow:<span class="w"> </span>False<span class="w">                  </span><span class="c1">#   | bool  | Enables MLFlow logging</span>
...<span class="w"> </span><span class="c1"># truncated for README</span>
<span class="w">  </span>extract:<span class="w">                         </span><span class="c1">#   | dict  | Options for the `extract` module</span>
<span class="w">    </span>enabled:<span class="w"> </span>True<span class="w">                  </span><span class="c1"># * | bool  | Enables/disables this module in a pipeline execution</span>
<span class="w">    </span>cores:<span class="w"> </span><span class="si">${</span><span class="nv">cores</span><span class="si">}</span><span class="w">                </span><span class="c1">#   | int   | Number of cores to use for the extract module</span>
<span class="w">    </span>method:<span class="w"> </span>tsfresh<span class="w">                </span><span class="c1"># * | str   | Window processing method</span>
<span class="w">    </span>file:<span class="w"> </span><span class="si">${</span><span class="nv">preprocess</span><span class="p">.file</span><span class="si">}</span><span class="w">       </span><span class="c1"># * | str   | Path to an H5 file to read from / write to</span>
<span class="w">    </span>output:<span class="w"> </span><span class="si">${</span><span class="nv">preprocess</span><span class="p">.file</span><span class="si">}</span>.pqt<span class="w"> </span><span class="c1"># * | str   | Path to write the intermediary data products of the extract script</span>
</code></pre></div>
<p>In the above example, the following magics are present:</p>
<ul>
<li><code>${!</code> means to "execute a function". A limited number of functions are presently supported. <code>${!os.cpu_count}</code> will execute the <code>os.cpu_count()</code> function and replaces the value. In this example, this value is <code>10</code>.</li>
<li><code>${</code> and <code>${.</code> refer to other keys in the config. <code>${</code> is the <strong>absolute</strong> path along the config, while <code>${.</code> is the <strong>relative</strong> path. In other words, <code>${cores}</code> refers to <code>generated.cores</code>, while <code>${.level}</code> is relative to its current section, so it points it <code>generated.log.level</code>.</li>
</ul>
<p>Note that this configuration assumes a user will using mlky patching, in which case the absolute pathing will be one level higher. That is why the magics are <code>${cores}</code> instead of <code>${generated.cores}</code>, as the <code>generated</code> section will be patched away.</p>
<p>These magics are important and useful for patching sections of the configuration together to create a new configuration setup. Consider the following configuration:</p>
<div class="highlight"><pre><span></span><code><span class="nt">generated</span><span class="p">:</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">...</span><span class="w"> </span><span class="c1"># Truncated</span>

<span class="c1"># Default Overrides</span>

<span class="nt">default</span><span class="p">:</span>
<span class="w">  </span><span class="nt">mlky.patch</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">generated</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="w">  </span><span class="nt">log</span><span class="p">:</span>
<span class="w">    </span><span class="nt">file</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${output}/${name}.log</span>
<span class="w">  </span><span class="nt">preprocess</span><span class="p">:</span>
<span class="w">    </span><span class="nt">file</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${output}/${name}.h5</span>
<span class="w">  </span><span class="nt">subselect</span><span class="p">:</span>
<span class="w">    </span><span class="nt">metadata</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${output}/${name}.metadata.pkl</span>
<span class="w">  </span><span class="nt">model</span><span class="p">:</span>
<span class="w">    </span><span class="nt">model</span><span class="p">:</span>
<span class="w">      </span><span class="nt">file</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${output}/${name}.model.pkl</span>
<span class="w">    </span><span class="nt">output</span><span class="p">:</span>
<span class="w">      </span><span class="nt">scores</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${output}/${name}.scores.pkl</span>
<span class="w">      </span><span class="nt">predicts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${output}/${name}.predicts.h5</span>

<span class="c1"># Systems</span>

<span class="nt">local</span><span class="p">:</span>
<span class="w">  </span><span class="nt">mlky.patch</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="w">  </span><span class="nt">input</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.</span>
<span class="w">  </span><span class="nt">output</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.</span>
<span class="w">  </span><span class="nt">data</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.</span>
<span class="w">  </span><span class="nt">preprocess</span><span class="p">:</span>
<span class="w">    </span><span class="nt">tracks</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${data}/v4.MMS.tracks.h5</span>
<span class="w">    </span><span class="nt">drs</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${data}/v3.drs.h5</span>

<span class="nt">mlia</span><span class="p">:</span>
<span class="w">  </span><span class="nt">mlky.patch</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="w">  </span><span class="nt">input</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/data/mlia/timefed/experiments</span>
<span class="w">  </span><span class="nt">output</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/data/mlia/timefed/experiments</span>
<span class="w">  </span><span class="nt">data</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/data/mlia/timefed/experiments</span>
<span class="w">  </span><span class="nt">preprocess</span><span class="p">:</span>
<span class="w">    </span><span class="nt">tracks</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${data}/v4.MMS.tracks.h5</span>
<span class="w">    </span><span class="nt">drs</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${data}/v3.drs.h5</span>

<span class="c1"># Runs</span>

<span class="nt">mms</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mms</span>
<span class="w">  </span><span class="nt">preprocess</span><span class="p">:</span>
<span class="w">    </span><span class="nt">only</span><span class="p">:</span>
<span class="w">      </span><span class="nt">drs</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">RFI</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SC</span>
<span class="w">    </span><span class="nt">features</span><span class="p">:</span>
<span class="w">      </span><span class="nt">diff</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CARRIER_SYSTEM_NOISE_TEMP</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AGC_VOLTAGE</span>
<span class="w">    </span><span class="nt">subsample</span><span class="p">:</span>
<span class="w">      </span><span class="nt">neg_ratio</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">  </span><span class="nt">extract</span><span class="p">:</span>
<span class="w">    </span><span class="nt">roll</span><span class="p">:</span>
<span class="w">      </span><span class="nt">window</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5 min</span>
<span class="w">      </span><span class="nt">frequency</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>

<span class="nt">mms1</span><span class="p">:</span>
<span class="w">  </span><span class="nt">mlky.patch</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mms</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mms1</span>
<span class="w">  </span><span class="nt">preprocess</span><span class="p">:</span>
<span class="w">    </span><span class="nt">only</span><span class="p">:</span>
<span class="w">      </span><span class="nt">missions</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MMS1</span>

<span class="nt">gnss</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gnss</span>
<span class="w">  </span><span class="nt">preprocess</span><span class="p">:</span>
<span class="w">    </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">    </span><span class="nt">file</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${output}/gnss_multi.h5</span>
<span class="w">  </span><span class="nt">extract</span><span class="p">:</span>
<span class="w">    </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">method</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">passthrough</span>
<span class="w">    </span><span class="nt">roll</span><span class="p">:</span>
<span class="w">      </span><span class="nt">window</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">14D</span>
<span class="w">      </span><span class="nt">frequency</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
<span class="w">      </span><span class="nt">step</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">7D</span>
</code></pre></div>
<p>The above configuration has 7 sections:
  - <code>generated</code>
  - <code>local</code>
  - <code>mlia</code>
  - <code>mms</code>
  - <code>mms1</code>
  - <code>gnss</code></p>
<p>These sections can be patched together to override keys and values. The patching syntax is the section names delineated by a <code>&lt;-</code>. For example,</p>
<ul>
<li><code>generated&lt;-default</code> will override keys/values in the <code>generated</code> section with those in the <code>default</code> section.</li>
<li><code>generated&lt;-default&lt;-local&lt;-mms</code> this first patches <code>generated</code> with <code>default</code>, then patches <code>local</code> onto that, and finally <code>mms</code> onto that. The section precedence increases from left to right.</li>
</ul>
<p>This can be tested via the <code>timefed config print</code> command</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>timefed<span class="w"> </span>config<span class="w"> </span>print<span class="w"> </span>--help
Usage:<span class="w"> </span>timefed<span class="w"> </span>config<span class="w"> </span>print<span class="w"> </span><span class="o">[</span>OPTIONS<span class="o">]</span>

<span class="w">  </span>Prints<span class="w"> </span>the<span class="w"> </span>yaml<span class="w"> </span>dump<span class="w"> </span><span class="k">for</span><span class="w"> </span>a<span class="w"> </span>configuration<span class="w"> </span>with<span class="w"> </span>a<span class="w"> </span>given<span class="w"> </span>patch<span class="w"> </span>input

Options:
<span class="w">  </span>-c,<span class="w"> </span>--config<span class="w"> </span>TEXT<span class="w">              </span>Path<span class="w"> </span>to<span class="w"> </span>a<span class="w"> </span>mlky<span class="w"> </span>config
<span class="w">  </span>-p,<span class="w"> </span>--patch<span class="w"> </span>TEXT<span class="w">               </span>Patch<span class="w"> </span>order<span class="w"> </span><span class="k">for</span><span class="w"> </span>mlky
</code></pre></div>
<p>Example: <code>timefed config print -c generated.yml -p "generated&lt;-patch"</code></p>
<p>The above configuration example also shows in-line patching via the <code>mlky.patch</code> key in a section. If these sections are included in the patch string then they will auto-patch other sections. For example, <code>generated&lt;-default&lt;-local&lt;-mms&lt;-mms1</code> is the same as <code>local&lt;-mms1</code> because <code>local</code> auto-patches <code>default</code>, which auto-patches <code>generated</code>, while <code>mms1</code> auto-patches <code>mms</code>.</p>
<p>This capability is very important to the scientists that created this system to quickly explore new configuration setups without creating new config files for each experiment. This enabled building complex configurations that built on previous experiments while maintaining experiment traceability.</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../usage/" class="btn btn-neutral float-left" title="Getting Started"><span class="icon icon-circle-arrow-left"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.jpl.nasa.gov/jamesmo/TimeFED" class="fa fa-code-fork" style="color: #fcfcfc"> jammont/TimeFED</a>
        </span>
    
    
      <span><a href="../usage/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../javascript/mkapi.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
